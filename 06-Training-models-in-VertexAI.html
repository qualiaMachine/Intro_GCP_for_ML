<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Intro to Google Cloud Platform (GCP) for Machine Learning: Training Models in Vertex AI: Intro</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="favicons/incubator/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicons/incubator/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicons/incubator/favicon-16x16.png"><link rel="manifest" href="favicons/incubator/site.webmanifest"><link rel="mask-icon" href="favicons/incubator/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Lesson Description" src="assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://docs.carpentries.org/resources/curriculum/lesson-life-cycle.html" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/06-Training-models-in-VertexAI.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Lesson Description" src="assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Intro to Google Cloud Platform (GCP) for Machine Learning
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Intro to Google Cloud Platform (GCP) for Machine Learning
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="glossary.html">Glossary</a></li><li><a class="dropdown-item" href="instances-for-ML.html">Compute for ML</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Intro to Google Cloud Platform (GCP) for Machine Learning
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 40%" class="percentage">
    40%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 40%" aria-valuenow="40" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/06-Training-models-in-VertexAI.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-Introduction.html">1. Overview of Google Cloud for Machine Learning</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-Data-storage.html">2. Data Storage: Setting up GCS</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-Notebooks-as-controllers.html">3. Notebooks as Controllers</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-Accessing-and-managing-data.html">4. Accessing and Managing Data in GCS with Vertex AI Notebooks</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-Interacting-with-code-repo.html">5. Using a GitHub Personal Access Token (PAT) to Push/Pull from a Vertex AI Notebook</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        6. Training Models in Vertex AI: Intro
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#initial-setup">Initial setup</a></li>
<li><a href="#testing-train.py-locally-in-the-notebook">Testing train.py locally in the notebook</a></li>
<li><a href="#download-data-into-notebook-environment">Download data into notebook environment</a></li>
<li><a href="#local-test-run-of-train.py">Local test run of train.py</a></li>
<li><a href="#training-via-vertex-ai-custom-training-job">Training via Vertex AI custom training job</a></li>
<li><a href="#monitoring-training-jobs-in-the-console">Monitoring training jobs in the Console</a></li>
<li><a href="#training-artifacts">Training artifacts</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07-Training-models-in-VertexAI-GPUs.html">7. Training Models in Vertex AI: PyTorch Example</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="08-Hyperparameter-tuning.html">8. Hyperparameter Tuning in Vertex AI: Neural Network Example</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="09-Resource-management-cleanup.html">9. Resource Management &amp; Monitoring on Vertex AI (GCP)</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="glossary.html">Glossary</a></li><li><a href="instances-for-ML.html">Compute for ML</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="05-Interacting-with-code-repo.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="07-Training-models-in-VertexAI-GPUs.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="05-Interacting-with-code-repo.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Using a GitHub
        </a>
        <a class="chapter-link float-end" href="07-Training-models-in-VertexAI-GPUs.html" rel="next">
          Next: Training Models in...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Training Models in Vertex AI: Intro</h1>
        <p>Last updated on 2025-10-29 |

        <a href="https://github.com/qualiaMachine/Intro_GCP_VertexAI/edit/main/episodes/06-Training-models-in-VertexAI.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>What are the differences between training locally in a Vertex AI
notebook and using Vertex AI-managed training jobs?<br></li>
<li>How do custom training jobs in Vertex AI streamline the training
process for various frameworks?<br></li>
<li>How does Vertex AI handle scaling across CPUs, GPUs, and TPUs?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Understand the difference between local training in a Vertex AI
Workbench notebook and submitting managed training jobs.<br></li>
<li>Learn to configure and use Vertex AI custom training jobs for
different frameworks (e.g., XGBoost, PyTorch, SKLearn).<br></li>
<li>Understand scaling options in Vertex AI, including when to use CPUs,
GPUs, or TPUs.<br></li>
<li>Compare performance, cost, and setup between custom scripts and
pre-built containers in Vertex AI.<br></li>
<li>Conduct training with data stored in GCS and monitor training job
status using the Google Cloud Console.</li>
</ul></div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="initial-setup">Initial setup<a class="anchor" aria-label="anchor" href="#initial-setup"></a></h2>
<hr class="half-width"><div class="section level4">
<h4 id="open-pre-filled-notebook">1. Open pre-filled notebook<a class="anchor" aria-label="anchor" href="#open-pre-filled-notebook"></a></h4>
<p>Navigate to
<code>/Intro_GCP_for_ML/notebooks/06-Training-models-in-VertexAI.ipynb</code>
to begin this notebook.</p>
</div>
<div class="section level4">
<h4 id="cd-to-instance-home-directory">2. CD to instance home directory<a class="anchor" aria-label="anchor" href="#cd-to-instance-home-directory"></a></h4>
<p>To ensure we’re all in the saming starting spot, change directory to
your Jupyter home directory.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="op">%</span>cd <span class="op">/</span>home<span class="op">/</span>jupyter<span class="op">/</span></span></code></pre>
</div>
</div>
<div class="section level4">
<h4 id="set-environment-variables">3. Set environment variables<a class="anchor" aria-label="anchor" href="#set-environment-variables"></a></h4>
<p>This code initializes the Vertex AI environment by importing the
Python SDK, setting the project, region, and defining a GCS bucket for
input/output data.</p>
<ul><li>
<code>PROJECT_ID</code>: Identifies your GCP project.<br></li>
<li>
<code>REGION</code>: Determines where training jobs run (choose a
region close to your data).</li>
</ul><div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="im">from</span> google.cloud <span class="im">import</span> storage</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>client <span class="op">=</span> storage.Client()</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>PROJECT_ID <span class="op">=</span> client.project</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>REGION <span class="op">=</span> <span class="st">"us-central1"</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>BUCKET_NAME <span class="op">=</span> <span class="st">"sinkorswim-johndoe-titanic"</span> <span class="co"># ADJUST to your bucket's name</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"project = </span><span class="sc">{</span>PROJECT_ID<span class="sc">}</span><span class="ch">\n</span><span class="ss">region = </span><span class="sc">{</span>REGION<span class="sc">}</span><span class="ch">\n</span><span class="ss">bucket = </span><span class="sc">{</span>BUCKET_NAME<span class="sc">}</span><span class="ss">"</span>)</span></code></pre>
</div>
</div>
</section><section><h2 class="section-heading" id="testing-train-py-locally-in-the-notebook">Testing train.py locally in the notebook<a class="anchor" aria-label="anchor" href="#testing-train-py-locally-in-the-notebook"></a></h2>
<hr class="half-width"><div id="understanding-the-xgboost-training-script-gcp-version" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<span class="callout-header">Discussion</span>
<div id="understanding-the-xgboost-training-script-gcp-version" class="callout-inner">
<h3 class="callout-title">Understanding the XGBoost Training Script (GCP
version)</h3>
<div class="callout-content">
<p>Take a moment to review the <code>train_xgboost.py</code> script
we’re using on GCP found in
<code>Intro_GCP-for_ML/scripts/train_xgboost.py</code>. This script
handles preprocessing, training, and saving an XGBoost model, while
supporting local paths and GCS (<code>gs://</code>) paths, and it adapts
to Vertex AI conventions (e.g., <code>AIP_MODEL_DIR</code>).</p>
<p>Try answering the following questions:</p>
<ol style="list-style-type: decimal"><li>
<strong>Data preprocessing</strong>: What transformations are
applied to the dataset before training?</li>
<li>
<strong>Training function</strong>: What does the
<code>train_model()</code> function do? Why print the training
time?</li>
<li>
<strong>Command-line arguments</strong>: What is the purpose of
<code>argparse</code> in this script? How would you change the number of
training rounds?</li>
<li>
<strong>Handling local vs. GCP runs</strong>: How does the script
let you run the same code locally, in Workbench, or as a Vertex AI job?
Which environment variable controls where the model artifact is
written?</li>
<li>
<strong>Training and saving the model</strong>: What format is the
dataset converted to before training, and why? How does the script save
to a local path vs. a <code>gs://</code> destination?</li>
</ol><p>After reviewing, discuss any questions or observations with your
group.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<ol style="list-style-type: decimal"><li>
<strong>Data preprocessing</strong>: The script fills missing values
(<code>Age</code> with median, <code>Embarked</code> with mode), maps
categorical fields to numeric (<code>Sex</code> → {male:1, female:0},
<code>Embarked</code> → {S:0, C:1, Q:2}), and drops non-predictive
columns (<code>Name</code>, <code>Ticket</code>,
<code>Cabin</code>).</li>
<li>
<strong>Training function</strong>: <code>train_model()</code>
constructs and fits an XGBoost model with the provided parameters and
prints wall-clock training time. Timing helps compare runs and make
sensible scaling choices.</li>
<li>
<strong>Command-line arguments</strong>: <code>argparse</code> lets
you set hyperparameters and file paths without editing code (e.g.,
<code>--max_depth</code>, <code>--eta</code>, <code>--num_round</code>,
<code>--train</code>). To change rounds:
<code>python train_xgboost.py --num_round 200</code>
</li>
<li>
<strong>Handling local vs. GCP runs</strong>:
<ul><li>
<strong>Input</strong>: You pass <code>--train</code> as either a
local path (<code>train.csv</code>) or a GCS URI
(<code>gs://bucket/path.csv</code>). The script automatically detects
<code>gs://</code> and reads the file directly from Cloud Storage using
the Python client.<br></li>
<li>
<strong>Output</strong>: If the environment variable
<code>AIP_MODEL_DIR</code> is set (as it is in Vertex AI CustomJobs),
the trained model is written there—often a <code>gs://</code> path.
Otherwise, the model is saved in the current working directory, which
works seamlessly in both local and Workbench environments.</li>
</ul></li>
<li>
<strong>Training and saving the model</strong>:<br>
The training data is converted into an <strong>XGBoost
<code>DMatrix</code></strong>, an optimized format that speeds up
training and reduces memory use. The trained model is serialized with
<code>joblib</code>. When saving locally, the file is written directly
to disk. If saving to a Cloud Storage path (<code>gs://...</code>), the
model is first saved to a temporary file and then uploaded to the
specified bucket.</li>
</ol></div>
</div>
</div>
</div>
<p>Before scaling training jobs onto managed resources, it’s essential
to test your training script locally. This prevents wasting GPU/TPU time
on bugs or misconfigured code.</p>
<div class="section level3">
<h3 id="guidelines-for-testing-ml-pipelines-before-scaling">Guidelines for testing ML pipelines before scaling<a class="anchor" aria-label="anchor" href="#guidelines-for-testing-ml-pipelines-before-scaling"></a></h3>
<ul><li>
<strong>Run tests locally first</strong> with small datasets.<br></li>
<li>
<strong>Use a subset of your dataset</strong> (1–5%) for fast
checks.<br></li>
<li>
<strong>Start with minimal compute</strong> before moving to larger
accelerators.<br></li>
<li>
<strong>Log key metrics</strong> such as loss curves and
runtimes.<br></li>
<li>
<strong>Verify correctness first</strong> before scaling up.</li>
</ul></div>
<div class="section level3">
<h3 id="what-tests-should-we-do-before-scaling">What tests should we do before scaling?<a class="anchor" aria-label="anchor" href="#what-tests-should-we-do-before-scaling"></a></h3>
<p>Before scaling to multiple or more powerful instances (e.g., GPUs or
TPUs), it’s important to run a few sanity checks. Skipping these can
lead to: silent data bugs, runtime blowups at scale, inefficient
experiments, or broken model artifacts.</p>
<p>Here is a non-exhaustive list of suggested tests to perform before
scaling up your compute needs.</p>
<ul><li>
<strong>Data loads correctly</strong> – dataset loads without
errors, expected columns exist, missing values handled.<br></li>
<li>
<strong>Overfitting check</strong> – train on a tiny dataset (e.g.,
100 rows). If it doesn’t overfit, something is off.<br></li>
<li>
<strong>Loss behavior</strong> – verify training loss decreases and
doesn’t diverge.<br></li>
<li>
<strong>Runtime estimate</strong> – get a rough sense of training
time on small data.<br></li>
<li>
<strong>Memory estimate</strong> – check approximate memory
use.<br></li>
<li>
<strong>Save &amp; reload</strong> – ensure model saves, reloads,
and infers without errors.</li>
</ul></div>
</section><section><h2 class="section-heading" id="download-data-into-notebook-environment">Download data into notebook environment<a class="anchor" aria-label="anchor" href="#download-data-into-notebook-environment"></a></h2>
<hr class="half-width"><p>Sometimes it’s helpful to keep a copy of data in your notebook VM for
quick iteration, even though <strong>GCS is the preferred storage
location</strong>.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="im">from</span> google.cloud <span class="im">import</span> storage</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>client <span class="op">=</span> storage.Client()</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>bucket <span class="op">=</span> client.bucket(BUCKET_NAME)</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>blob <span class="op">=</span> bucket.blob(<span class="st">"titanic_train.csv"</span>)</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>blob.download_to_filename(<span class="st">"titanic_train.csv"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Downloaded titanic_train.csv"</span>)</span></code></pre>
</div>
</section><section><h2 class="section-heading" id="local-test-run-of-train-py">Local test run of train.py<a class="anchor" aria-label="anchor" href="#local-test-run-of-train-py"></a></h2>
<hr class="half-width"><p><strong>Outside of this workshop, you should run these kinds of tests
on your local laptop or lab PC when possible.</strong> We’re using the
Workbench VM here only for convenience in this workshop setting, but
this does incur a small fee for our running VM.</p>
<ul><li>For large datasets, use a small representative sample of the total
dataset when testing locally (i.e., just to verify that code is working
and model overfits nearly perfectly after training enough epochs)</li>
<li>For larger models, use smaller model equivalents (e.g., 100M vs 7B
params) when testing locally</li>
</ul><div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="im">import</span> time <span class="im">as</span> t</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>start <span class="op">=</span> t.time()</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co"># Example: run your custom training script with args</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="op">!</span>python Intro_GCP_for_ML<span class="op">/</span>scripts<span class="op">/</span>train_xgboost.py <span class="op">--</span>max_depth <span class="dv">3</span> <span class="op">--</span>eta <span class="fl">0.1</span> <span class="op">--</span>subsample <span class="fl">0.8</span> <span class="op">--</span>colsample_bytree <span class="fl">0.8</span> <span class="op">--</span>num_round <span class="dv">100</span> <span class="op">--</span>train titanic_train.csv</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total local runtime: </span><span class="sc">{</span>t<span class="sc">.</span>time() <span class="op">-</span> start<span class="sc">:.2f}</span><span class="ss"> seconds"</span>)</span></code></pre>
</div>
<p>Training on this small dataset should take &lt;1 minute. Log runtime
as a baseline. You should see the following output file:</p>
<ul><li>
<code>xgboost-model</code> # Python-serialized XGBoost model
(Booster) via joblib; load with joblib.load for reuse.</li>
</ul></section><section><h2 class="section-heading" id="training-via-vertex-ai-custom-training-job">Training via Vertex AI custom training job<a class="anchor" aria-label="anchor" href="#training-via-vertex-ai-custom-training-job"></a></h2>
<hr class="half-width"><p>Unlike “local” training using our notebook’s VM, this next approach
launches a <strong>managed training job</strong> that runs on scalable
compute. Vertex AI handles provisioning, scaling, logging, and saving
outputs to GCS.</p>
<div class="section level3">
<h3 id="which-machine-type-to-start-with">Which machine type to start with?<a class="anchor" aria-label="anchor" href="#which-machine-type-to-start-with"></a></h3>
<p>Start with a small CPU machine like <code>n1-standard-4</code>. Only
scale up to GPUs/TPUs once you’ve verified your script. See <a href="https://qualiamachine.github.io/Intro_GCP_for_ML/instances-for-ML.html" class="external-link">Instances
for ML on GCP</a> for guidance.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>MACHINE <span class="op">=</span> <span class="st">'n1-standard-4'</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="creating-a-custom-training-job-with-the-sdk">Creating a custom training job with the SDK<a class="anchor" aria-label="anchor" href="#creating-a-custom-training-job-with-the-sdk"></a></h3>
<p>We’ll first initialize the Vertex AI platform with our environment
variables. We’ll also set a <code>RUN_ID</code> and
<code>ARTIFACT_DIR</code> to help store outputs.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="im">from</span> google.cloud <span class="im">import</span> aiplatform</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="im">import</span> datetime <span class="im">as</span> dt</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>RUN_ID <span class="op">=</span> dt.datetime.now().strftime(<span class="st">"%Y%m</span><span class="sc">%d</span><span class="st">-%H%M%S"</span>)</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"project = </span><span class="sc">{</span>PROJECT_ID<span class="sc">}</span><span class="ch">\n</span><span class="ss">region = </span><span class="sc">{</span>REGION<span class="sc">}</span><span class="ch">\n</span><span class="ss">bucket = </span><span class="sc">{</span>BUCKET_NAME<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>ARTIFACT_DIR <span class="op">=</span> <span class="ss">f"gs://</span><span class="sc">{</span>BUCKET_NAME<span class="sc">}</span><span class="ss">/artifacts/xgb/</span><span class="sc">{</span>RUN_ID<span class="sc">}</span><span class="ss">/"</span>  <span class="co"># everything will live beside this</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co"># Staging bucket is only for the SDK's temp code tarball (aiplatform-*.tar.gz)</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>aiplatform.init(project<span class="op">=</span>PROJECT_ID, location<span class="op">=</span>REGION, staging_bucket<span class="op">=</span><span class="ss">f"gs://</span><span class="sc">{</span>BUCKET_NAME<span class="sc">}</span><span class="ss">/.vertex_staging"</span>)</span></code></pre>
</div>
<p>This next section defines a custom training job in Vertex AI,
specifying how and where the training code will run. It points to your
training script (<code>train_xgboost.py</code>), uses Google’s prebuilt
XGBoost training container image, and installs any extra dependencies
your script needs (in this case, <code>google-cloud-storage</code> for
accessing GCS). The <code>display_name</code> sets a readable name for
tracking the job in the Vertex AI console.</p>
<div class="section level4">
<h4 id="prebuilt-containers-for-training">Prebuilt containers for training<a class="anchor" aria-label="anchor" href="#prebuilt-containers-for-training"></a></h4>
<p>Vertex AI provides prebuilt Docker container images for model
training. These containers are organized by machine learning frameworks
and framework versions and include common dependencies that you might
want to use in your training code. To learn about which PyTorch versions
have prebuilt training containers and how to train models with a
prebuilt training container, see <a href="https://docs.cloud.google.com/vertex-ai/docs/predictions/pre-built-containers" class="external-link">Prebuilt
containers for custom training</a>.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>job <span class="op">=</span> aiplatform.CustomTrainingJob(</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>    display_name<span class="op">=</span><span class="ss">f"endemann_xgb_</span><span class="sc">{</span>RUN_ID<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>    script_path<span class="op">=</span><span class="st">"Intro_GCP_for_ML/scripts/train_xgboost.py"</span>,</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>    container_uri<span class="op">=</span><span class="st">"us-docker.pkg.dev/vertex-ai/training/xgboost-cpu.2-1:latest"</span>,</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>    requirements<span class="op">=</span>[<span class="st">"google-cloud-storage"</span>],  <span class="co"># Our train_xgboost.py script uses storage.Client(), which isn't included in the xgboost image. We add it here.</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>)</span></code></pre>
</div>
<p>Finally, this next block launches the custom training job on Vertex
AI using the configuration defined earlier. **We won’t be charged for
our selected <code>MACHINE</code> until we run the below code using
<code>job.run()</code>. This marks the point when our script actually
begins executing remotely on the Vertex training infrastructure. Once
job.run() is called, Vertex handles packaging your training script,
transferring it to the managed training environment, provisioning the
requested compute instance, and monitoring the run. The job’s status and
logs can be viewed directly in the Vertex AI Console under Training →
Custom jobs.</p>
<p>If you need to cancel or modify a job mid-run, you can do so from the
console or via the SDK by calling job.cancel(). When the job completes,
Vertex automatically tears down the compute resources so you only pay
for the active training time.</p>
<ul><li>The <code>args</code> list passes command-line parameters directly
into your training script, including hyperparameters and the path to the
training data in GCS.<br></li>
<li>
<code>base_output_dir</code> specifies where all outputs (model,
metrics, logs) will be written in Cloud Storage</li>
<li>
<code>machine_type</code> controls the compute resources used for
training.</li>
<li>When <code>sync=True</code>, the notebook waits until the job
finishes before continuing, making it easier to inspect results
immediately after training.</li>
</ul><div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>job.run(</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>    args<span class="op">=</span>[</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>        <span class="ss">f"--train=gs://</span><span class="sc">{</span>BUCKET_NAME<span class="sc">}</span><span class="ss">/titanic_train.csv"</span>,</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>        <span class="st">"--max_depth=3"</span>,</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>        <span class="st">"--eta=0.1"</span>,</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>        <span class="st">"--subsample=0.8"</span>,</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>        <span class="st">"--colsample_bytree=0.8"</span>,</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>        <span class="st">"--num_round=100"</span>,</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>    ],</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>    replica_count<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>    machine_type<span class="op">=</span>MACHINE, <span class="co"># MACHINE variable defined above; adjust to something more powerful when needed</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>    base_output_dir<span class="op">=</span>ARTIFACT_DIR,  <span class="co"># sets AIP_MODEL_DIR for your script</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>    sync<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>)</span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Model + logs folder:"</span>, ARTIFACT_DIR)</span></code></pre>
</div>
<p>This launches a managed training job with Vertex AI. It should take
2-5 minutes for the training job to complete.</p>
</div>
</div>
<div class="section level3">
<h3 id="understanding-the-training-output-message">Understanding the training output message<a class="anchor" aria-label="anchor" href="#understanding-the-training-output-message"></a></h3>
<p>After your job finishes, you may see a message like:
<code>Training did not produce a Managed Model returning None.</code>
This is expected when running a <code>CustomTrainingJob</code> without
specifying deployment parameters. Vertex AI supports two modes:</p>
<ul><li>
<strong>CustomTrainingJob (research/development)</strong> – You
control training and save models/logs to Cloud Storage via
<code>AIP_MODEL_DIR</code>. This is ideal for experimentation and cost
control.</li>
<li>
<strong>TrainingPipeline (for deployment)</strong> – You include
<code>model_serving_container_image_uri</code> and
<code>model_display_name</code>, and Vertex automatically registers a
<em>Managed Model</em> in the Model Registry for deployment to an
endpoint.</li>
</ul><p>In our setup, we’re intentionally using the simpler
<strong>CustomTrainingJob</strong> path. Your trained model is safely
stored under your specified artifact directory (e.g.,
<code>gs://{BUCKET_NAME}/artifacts/xgb/{RUN_ID}/</code>), and you can
later register or deploy it manually when ready.</p>
</div>
</section><section><h2 class="section-heading" id="monitoring-training-jobs-in-the-console">Monitoring training jobs in the Console<a class="anchor" aria-label="anchor" href="#monitoring-training-jobs-in-the-console"></a></h2>
<hr class="half-width"><ol style="list-style-type: decimal"><li>Go to the Google Cloud Console.<br></li>
<li>Navigate to <strong>Vertex AI &gt; Training &gt; Custom
Jobs</strong>.<br></li>
<li>Click on your job name to see status, logs, and output model
artifacts.<br></li>
<li>Cancel jobs from the console if needed (be careful not to stop jobs
you don’t own in shared projects).</li>
</ol><div class="section level4">
<h4 id="visit-training-pipelines-to-verify-its-running-">Visit “training pipelines” to verify it’s running.<a class="anchor" aria-label="anchor" href="#visit-training-pipelines-to-verify-its-running-"></a></h4>
<p><a href="https://console.cloud.google.com/vertex-ai/training/training-pipelines?hl=en&amp;project=doit-rci-mlm25-4626" class="external-link uri">https://console.cloud.google.com/vertex-ai/training/training-pipelines?hl=en&amp;project=doit-rci-mlm25-4626</a></p>
</div>
</section><section><h2 class="section-heading" id="training-artifacts">Training artifacts<a class="anchor" aria-label="anchor" href="#training-artifacts"></a></h2>
<hr class="half-width"><p>After the training run completes, we can manually view our bucket
using the Google Cloud Console or run the below code.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>total_size_bytes <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="co"># bucket = client.bucket(BUCKET_NAME)</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="cf">for</span> blob <span class="kw">in</span> client.list_blobs(BUCKET_NAME):</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>    total_size_bytes <span class="op">+=</span> blob.size</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>    <span class="bu">print</span>(blob.name)</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>total_size_mb <span class="op">=</span> total_size_bytes <span class="op">/</span> (<span class="dv">1024</span><span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total size of bucket '</span><span class="sc">{</span>BUCKET_NAME<span class="sc">}</span><span class="ss">': </span><span class="sc">{</span>total_size_mb<span class="sc">:.2f}</span><span class="ss"> MB"</span>)</span></code></pre>
</div>
<div class="section level4">
<h4 id="training-artifacts-artifact_dir">Training Artifacts → <code>ARTIFACT_DIR</code>
<a class="anchor" aria-label="anchor" href="#training-artifacts-artifact_dir"></a></h4>
<p>This is your <em>intended output location</em>, set via
<code>base_output_dir</code>.<br>
It contains everything your training script explicitly writes. In our
case, this includes:</p>
<ul><li>
<strong><code>{BUCKET_NAME}/artifacts/xgb/{RUN_ID}/xgboost-model</code></strong>
— Serialized XGBoost model (Booster) saved via <code>joblib</code>;
reload later with <code>joblib.load()</code> for reuse or
deployment.</li>
</ul></div>
<div class="section level4">
<h4 id="system-generated-files">System-Generated Files<a class="anchor" aria-label="anchor" href="#system-generated-files"></a></h4>
<p>Additional system-generated files (e.g., Vertex’s
<code>.tar.gz</code> code package or <code>executor_output.json</code>)
will appear under <code>.vertex_staging/</code> and can be safely
ignored or auto-deleted via lifecycle rules.</p>
</div>
<div class="section level3">
<h3 id="when-training-takes-too-long">When training takes too long<a class="anchor" aria-label="anchor" href="#when-training-takes-too-long"></a></h3>
<p>Two main options in Vertex AI:</p>
<p><strong>Option 1: Upgrade to more powerful machine
types</strong><br>
- The simplest way to reduce training time is to use a larger machine or
add GPUs (e.g., T4, V100, A100).<br>
- This works best for small or medium datasets (&lt;10 GB) and avoids
the coordination overhead of distributed training.<br>
- GPUs and TPUs can accelerate deep learning workloads
significantly.</p>
<p><strong>Option 2: Use distributed training with multiple
replicas</strong><br>
- Vertex AI supports distributed training for many frameworks.<br>
- The dataset is split across replicas, each training a portion of the
data with synchronized gradient updates.<br>
- This approach is most useful for large datasets and long-running
jobs.</p>
<p><strong>When distributed training makes sense</strong><br>
- Dataset size exceeds 10–50 GB.<br>
- Training on a single machine takes more than 10 hours.<br>
- The model is a deep learning workload that scales naturally across
GPUs or TPUs.</p>
<p>We will explore both options more in depth in the next episode when
we train a neural network.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul><li>
<strong>Environment initialization</strong>: Use
<code>aiplatform.init()</code> to set defaults for project, region, and
bucket.<br></li>
<li>
<strong>Local vs managed training</strong>: Test locally before
scaling into managed jobs.<br></li>
<li>
<strong>Custom jobs</strong>: Vertex AI lets you run scripts as
managed training jobs using pre-built or custom containers.<br></li>
<li>
<strong>Scaling</strong>: Start small, then scale up to GPUs or
distributed jobs as dataset/model size grows.<br></li>
<li>
<strong>Monitoring</strong>: Track job logs and artifacts in the
Vertex AI Console.</li>
</ul></div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="05-Interacting-with-code-repo.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="07-Training-models-in-VertexAI-GPUs.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="05-Interacting-with-code-repo.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Using a GitHub
        </a>
        <a class="chapter-link float-end" href="07-Training-models-in-VertexAI-GPUs.html" rel="next">
          Next: Training Models in...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/qualiaMachine/Intro_GCP_VertexAI/edit/main/episodes/06-Training-models-in-VertexAI.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/qualiaMachine/Intro_GCP_VertexAI/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/qualiaMachine/Intro_GCP_VertexAI/" class="external-link">Source</a></p>
				<p><a href="https://github.com/qualiaMachine/Intro_GCP_VertexAI/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:endemann@wisc.edu">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.17.1" class="external-link">sandpaper (0.17.1)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.7" class="external-link">varnish (1.0.7)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "LearningResource",
  "@id": "https://qualiaMachine.github.io/Intro_GCP_VertexAI/06-Training-models-in-VertexAI.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/LearningResource/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "cloud, GCP, lesson, The Carpentries, ML, AI, GPU",
  "name": "Training Models in Vertex AI: Intro",
  "creativeWorkStatus": "active",
  "url": "https://qualiaMachine.github.io/Intro_GCP_VertexAI/06-Training-models-in-VertexAI.html",
  "identifier": "https://qualiaMachine.github.io/Intro_GCP_VertexAI/06-Training-models-in-VertexAI.html",
  "dateCreated": "2025-08-26",
  "dateModified": "2025-10-29",
  "datePublished": "2025-10-30"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

